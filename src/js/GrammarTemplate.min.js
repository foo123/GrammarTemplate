/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 1.0.0
*   https://github.com/foo123/grammar-template
*
**/
!function(e,n,t){"use strict";var l;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=l=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return l})}(this,"GrammarTemplate",function(){"use strict";function e(e){return e instanceof Array||"[object Array]"===s.call(e)}var n,t="prototype",l="hasOwnProperty",s=Object[t].toString,u="charAt",r=/^\s+|\s+$/g,i=String[t].trim?function(e){return e.trim()}:function(e){return e.replace(r,"")};return n=function o(e,n){var t=this;return t instanceof o?(t.id=null,t.tpl=null,t._args=[e||"",n||o.defaultDelims],void(t._parsed=!1)):new o(e,n)},n.VERSION="1.0.0",n.defaultDelims=["<",">","[","]"],n.multisplit=function(e,n){var t,l,s,r,o,p,f,c,a,h,g,d,m=n[0],y=n[1],_=n[2],b=n[3],v=m.length,O=y.length,j=_.length,C=b.length,I="?",S="*",q="!",x="|",D="{",A="}",E=null,w=0,B=0,M=e.length;for(h=0,f=[[],null,0,0,0,0,null],o=[],a="";M>h;)if(m===e.substr(h,v))h+=v,a.length&&f[0].push([0,a]),a="";else if(y===e.substr(h,O)){if(h+=O,s=a,a="",-1<(r=s.indexOf(x))?(E=s.slice(r+1),s=s.slice(0,r)):E=null,p=s[u](0),I===p||S===p)B=1,S===p?(t=1,l=-1):(t=0,l=0),s=s.slice(1),q===s[u](0)?(w=1,s=s.slice(1)):w=0;else if(D===p){for(a="",g=1,d=s.length;d>g&&A!==s[u](g);)a+=s[u](g++);s=s.slice(g+1),a=a.split(","),a.length>1?(t=i(a[0]),t=t.length?parseInt(t,10)||0:0,l=i(a[1]),l=l.length?parseInt(l,10)||0:-1,B=1):(t=i(a[0]),t=t.length?parseInt(t,10)||0:0,l=t,B=0),a="",w=0}else B=0,w=0,t=0,l=0;w&&null===E&&(E=""),B&&!f[2]?(f[1]=s,f[2]=B,f[3]=w,f[4]=t,f[5]=l,f[6]=[[s,w,t,l]]):B?f[6].push([s,w,t,l]):B||null!==f[1]||(f[1]=s,f[2]=0,f[3]=w,f[4]=t,f[5]=l,f[6]=[[s,w,t,l]]),f[0].push([1,s,E,B,w,t,l])}else _===e.substr(h,j)?(h+=j,a.length&&f[0].push([0,a]),a="",o.push(f),f=[[],null,0,0,0,0,null]):b===e.substr(h,C)?(h+=C,c=f,f=o.pop(),a.length&&c[0].push([0,a]),a="",f[0].push([-1,c[1],c[2],c[3],c[4],c[5],c[6],c[0]])):a+=e[u](h++);return a.length&&f[0].push([0,a]),f[0]},n[t]={constructor:n,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},render:function(t){var s=this;!1===s._parsed&&(s.tpl=n.multisplit(s._args[0],s._args[1]),s._args=null,s._parsed=!0),t=t||{};var u,r,i,o,p,f,c,a,h,g,d,m,y,_=s.tpl,b=_.length,v=[],O=Math.min,j=null,C=0,I="";for(i=0;b>i||v.length;)if(i>=b)u=v.pop(),_=u[0],i=u[1],b=u[2],j=u[3]||null,C=u[4]||0;else{if(o=_[i],p=o[0],f=o[1],-1===p){if(h=o[6],h&&h.length){for(g=!0,d=0,m=h.length;m>d;d++)if(y=h[d],0===y[1]&&!t[l](y[0])||1===y[1]&&t[l](y[0])){g=!1;break}if(g){if(1===o[3]){v.push([_,i+1,b,j,C]),_=o[7],i=0,b=_.length,j=null,C=0;continue}if(r=e(t[f]),r&&o[4]!==o[5]&&t[f].length>o[4]){if(c=o[4],a=-1===o[5]?t[f].length-1:O(o[5],t[f].length-1),a>=c){for(v.push([_,i+1,b,j,C]),_=o[7],i=0,b=_.length,j=f,C=a;C>c;C--)v.push([_,0,b,j,C]);C=c;continue}}else if(!r&&o[4]===o[5]){v.push([_,i+1,b,j,C]),_=o[7],i=0,b=_.length,j=f,C=0;continue}}}}else I+=1===p?t[l](f)||null===o[2]?e(t[f])?f===j?t[f][o[5]===o[6]?o[5]:C]:t[f][o[5]]:t[f]:o[2]:f;i++}return I}},n});