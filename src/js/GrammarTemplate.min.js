/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 3.0.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(l,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(l.$deps=l.$deps||{})&&(l.EXPORTED_SYMBOLS=[n])&&(l[n]=l.$deps[n]=e.call(l)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(l)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,e.call(l))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(l)}):n in l||(l[n]=e.call(l)||1)&&"function"==typeof define&&define.amd&&define(function(){return l[n]})}(this,"GrammarTemplate",function(l){"use strict";function n(l,n){return l&&m.call(l,n)?1:0}function e(l,n,e,t){var u=String(l);if(e=e||"0",t)for(;u.length<n;)u+=e;else for(;u.length<n;)u=e+u;return u}function t(){return t.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(t.GUID.toString(16),4)}function u(l){return l instanceof Array||"[object Array]"===h.call(l)}function r(l,n){for(var e,t="",u=0,r=l.length;r>u&&(e=l[y](u)," "===e||"\r"===e||"	"===e||"\x0B"===e||"\x00"===e);)t+=e,u+=1;return t}function o(l,n){var e,t,u,r=l.length;if(r&&n.length)for(e="",u=0;r>u;u++)t=l[y](u),e+=t,"\n"===t&&(e+=n);else e=l;return e}function a(l,n,e,t){var u,r,o,a,i=0;if(n)for(u=l,r=n.length,o=0,i=1;r>o;){if(a=n[o++],null==u||null==u[a]){i=0;break}u=u[a]}if(!i&&e)for(u=l,r=e.length,o=0,i=1;r>o;){if(a=e[o++],null==u||null==u[a]){i=0;break}u=u[a]}if(!i&&null!=t&&t!==l){if(n)for(u=t,r=n.length,o=0,i=1;r>o;){if(a=n[o++],null==u||null==u[a]){i=0;break}u=u[a]}if(!i&&e)for(u=t,r=e.length,o=0,i=1;r>o;){if(a=e[o++],null==u||null==u[a]){i=0;break}u=u[a]}}return i?u:null}function i(l,n){this.prev=l||null,this.value=n||null}function s(l,n){n&&(n.next=this),this.node=l||null,this.prev=n||null,this.next=null}function f(l,e,u){var r,o,a,f,p,d,c,g,v,m,h,b,S,k,G,_,x,O,D,$,j,A,C,I,U,q,B,E=e[0],T=e[1],M=e[2],P=e[3],R=e[4],L=E.length,N=T.length,V=M.length,X=P.length,Y=R.length,z="\\",F="?",H="*",J="!",K="|",Q="#",W="{",Z="}",ll=".",nl=":",el="@",tl=null,ul=0,rl=0,ol=0,al=0,il=l.length;for(u=!0===u,v=new s({type:0,val:""}),j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},C=v,I=null,A=null,x={},D=null,O={},$=null,c=null,h="",G=!1,b=0;il>b;)if(G=!1,_=l[y](b),z===_&&(G=!0,b+=1),E===l.substr(b,L)){if(b+=L,G){h+=E;continue}h.length&&(0===v.node.type?v.node.val+=h:v=new s({type:0,val:h},v)),h=""}else if(T===l.substr(b,N)){if(b+=N,G){h+=T;continue}if(p=h,h="",-1<(d=p.indexOf(K))?(tl=p.slice(d+1),p=p.slice(0,d)):tl=null,g=u?il>b?l[y](b):"":p[y](0),F===g||H===g)rl=1,H===g?(o=1,a=-1):(o=0,a=0),u?(b+=1,il>b&&J===l[y](b)?(ul=1,b+=1):ul=0):J===p[y](1)?(ul=1,p=p.slice(2)):(ul=0,p=p.slice(1));else if(W===g){if(u){for(h="",S=b+1,k=il;k>S&&Z!==l[y](S);)h+=l[y](S++);b=S+1}else{for(h="",S=1,k=p.length;k>S&&Z!==p[y](S);)h+=p[y](S++);p=p.slice(S+1)}h=h.split(","),h.length>1?(o=w(h[0]),o=o.length?0|+o:0,a=w(h[1]),a=a.length?0|+a:-1,rl=1):(o=w(h[0]),o=o.length?0|+o:0,a=o,rl=0),h="",ul=0}else rl=0,ul=0,o=0,a=0;if(ul&&null===tl&&(tl=""),g=p[y](0),el===g?(ol=1,p=p.slice(1)):ol=0,g=p[y](0),ll===g?(al=1,p=p.slice(1)):al=0,f=-1<p.indexOf(nl)?p.split(nl):[p,null],p=f[0],f=f[1],r=-1<p.indexOf(ll)?p.split(ll):null,D&&!n(O,D)&&(O[D]={}),R+M===l.substr(b,Y+V)&&(b+=Y,f=f&&f.length?f:"grtpl--"+t(),$=f,D&&p.length&&(O[D][p]=f)),!p.length)continue;null==f&&D&&n(O,D)&&n(O[D],p)&&(f=O[D][p]),rl&&!j.opt?(j.name=p,j.key=r,j.stpl=f,j.dval=tl,j.opt=rl,j.neg=ul,j.algn=ol,j.loc=al,j.start=o,j.end=a,A=new i(null,[p,r,ul,o,a,rl,al])):rl?(o!==a&&j.start===j.end&&(j.name=p,j.key=r,j.stpl=f,j.dval=tl,j.opt=rl,j.neg=ul,j.algn=ol,j.loc=al,j.start=o,j.end=a),A=new i(A,[p,r,ul,o,a,rl,al])):rl||null!==j.name||(j.name=p,j.key=r,j.stpl=f,j.dval=tl,j.opt=0,j.neg=ul,j.algn=ol,j.loc=al,j.start=o,j.end=a,A=new i(null,[p,r,ul,o,a,0,al])),v=new s({type:1,name:p,key:r,stpl:f,dval:tl,opt:rl,algn:ol,loc:al,start:o,end:a},v)}else if(M===l.substr(b,V)){if(b+=V,G){h+=M;continue}if(h.length&&(0===v.node.type?v.node.val+=h:v=new s({type:0,val:h},v)),h="",Q===l[y](b)){for(S=b+1,k=il;k>S&&Q+P!==l.substr(S,X+1);)h+=l[y](S++);b=S+X+1,v=new s({type:-100,val:h},v),h="";continue}c=new i(c,[v,I,j,A,D,$]),$&&(D=$),$=null,j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},A=null,v=new s({type:0,val:""}),I=v}else if(P===l.substr(b,X)){if(b+=X,G){h+=P;continue}m=v,U=I,q=j,B=A,c?(v=c.value[0],I=c.value[1],j=c.value[2],A=c.value[3],D=c.value[4],$=c.value[5],c=c.prev):v=null,h.length&&(0===m.node.type?m.node.val+=h:m=new s({type:0,val:h},m)),h="",$?(x[$]=new s({type:2,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:null,tpl:U}),$=null):v=new s({type:-1,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:B,tpl:U},v)}else _=l[y](b++),"\n"===_?(h.length&&(0===v.node.type?v.node.val+=h:v=new s({type:0,val:h},v)),h="",v=new s({type:100,val:"\n"},v)):h+=_;return h.length&&(0===v.node.type?v.node.val+=h:v=new s({type:0,val:h},v)),[C,x]}function p(l,n,e,t,r,o,i){var s,f,p,d,g,v,y,m,h=null,b="";if(-1===n.type){if(s=n.opt_args,s&&s.value[5])for(;s;){if(f=s.value,p=a(l,f[1],[String(f[0])],f[6]?null:i),null===h&&n.name===f[0]&&(h=p),0===f[2]&&null==p||1===f[2]&&null!=p)return"";s=s.prev}}else h=a(l,n.key,[String(n.name)],n.loc?null:i);if(d=u(h),m=d?h.length:-1,d&&m>n.start)for(g=n.start,v=-1===n.end?m-1:Math.min(n.end,m-1),y=g;v>=y;y++)b+=c(l,n.tpl,e,t,y,o,i);else d||n.start!==n.end||(b=c(l,n.tpl,e,t,null,o,i));return b}function d(l,e,t,r,i,s,f){var d,c,v,y,m="";if(e.stpl&&(n(t,e.stpl)||n(g.subGlobal,e.stpl)||n(r,e.stpl)||n(r,"*")||n(g.fnGlobal,e.stpl)||n(g.fnGlobal,"*")))if(d=a(l,e.key,[String(e.name)],e.loc?null:f),n(t,e.stpl)||n(g.subGlobal,e.stpl))null==i||0===i&&e.start===e.end&&e.opt||!u(d)||(d=i<d.length?d[i]:null),null==d&&null!==e.dval?m=e.dval:(v=n(t,e.stpl)?t[e.stpl].node:g.subGlobal[e.stpl].node,c={},null!=d&&(u(d)?c[v.name]=d:c=d),m=p(c,v,t,r,null,e.algn?s:"",null==f?l:f));else{if(y=null,n(r,e.stpl)?y=r[e.stpl]:n(r,"*")?y=r["*"]:n(g.fnGlobal,e.stpl)?y=g.fnGlobal[e.stpl]:g.fnGlobal["*"]&&(y=g.fnGlobal["*"]),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),"function"==typeof y){var h={symbol:e,index:i,currentArguments:l,originalArguments:f,alignment:s};d=y(d,h)}else d=String(y);m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=o(m,s))}else e.opt&&null!==e.dval?m=e.dval:(d=a(l,e.key,[String(e.name)],e.loc?null:f),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=o(m,s)));return m}function c(l,n,e,t,u,o,a){var i,s,f="",c="";for(o=o||"",c=o;n;)i=n.node.type,-1===i?f+=p(l,n.node,e,t,u,c,a):1===i?f+=d(l,n.node,e,t,u,c,a):0===i?(s=n.node.val,c+=r(s),f+=s):100===i&&(f+="\n"+o,c=o),n=n.next;return f}function g(l,n,e){var t=this;return t instanceof g?(t.id=null,t.tpl=null,t.fn={},void(t._args=[l||"",n||g.defaultDelims,e||!1])):new g(l,n,e)}var v="prototype",y="charAt",m=Object[v].hasOwnProperty,h=Object[v].toString,b=/^\s+|\s+$/g,w=String[v].trim?function(l){return l.trim()}:function(l){return l.replace(b,"")};return t.GUID=0,g.VERSION="3.0.0",g.defaultDelims=["<",">","[","]",":="],g.fnGlobal={},g.subGlobal={},g.guid=t,g.multisplit=f,g.align=o,g.main=c,g[v]={constructor:g,id:null,tpl:null,fn:null,_args:null,dispose:function(){var l=this;return l.id=null,l.tpl=null,l.fn=null,l._args=null,l},parse:function(){var l=this;return null===l.tpl&&null!==l._args&&(l.tpl=g.multisplit(l._args[0],l._args[1],l._args[2]),l._args=null),l},render:function(l){var n=this;return null===n.tpl&&n.parse(),g.main(null==l?{}:l,n.tpl[0],n.tpl[1],n.fn)}},g});