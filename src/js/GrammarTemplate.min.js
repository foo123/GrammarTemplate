/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 3.0.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(l,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(l.$deps=l.$deps||{})&&(l.EXPORTED_SYMBOLS=[n])&&(l[n]=l.$deps[n]=e.call(l)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(l)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,e.call(l))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(l)}):n in l||(l[n]=e.call(l)||1)&&"function"==typeof define&&define.amd&&define(function(){return l[n]})}(this,"GrammarTemplate",function(l){"use strict";function n(l,n){return l&&m.call(l,n)?1:0}function e(l,n,e,t){var u=String(l);if(e=e||"0",t)for(;u.length<n;)u+=e;else for(;u.length<n;)u=e+u;return u}function t(){return t.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(t.GUID.toString(16),4)}function u(l){return l instanceof Array||"[object Array]"===h.call(l)}function o(l,n,e){for(var t,u="";e>n&&(t=l[y](n)," "===t||"\r"===t||"	"===t||"\x0B"===t||"\x00"===t);)u+=t,n+=1;return u}function a(l,n){var e,t,u,o=l.length;if(o&&n.length)for(e="",u=0;o>u;u++)t=l[y](u),e+=t,"\n"===t&&(e+=n);else e=l;return e}function r(l,n,e,t){var u,o,a,r,i=0;if(n)for(u=l,o=n.length,a=0,i=1;o>a;){if(r=n[a++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&e)for(u=l,o=e.length,a=0,i=1;o>a;){if(r=e[a++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&null!=t&&t!==l){if(n)for(u=t,o=n.length,a=0,i=1;o>a;){if(r=n[a++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&e)for(u=t,o=e.length,a=0,i=1;o>a;){if(r=e[a++],null==u||null==u[r]){i=0;break}u=u[r]}}return i?u:null}function i(l,n){this.prev=l||null,this.value=n||null}function s(l,n){n&&(n.next=this),this.node=l||null,this.prev=n||null,this.next=null}function f(l,e,u){var a,r,f,p,d,g,c,v,m,h,b,S,k,G,_,x,O,D,$,j,A,C,I,U,q,B,E,T=e[0],M=e[1],P=e[2],R=e[3],L=e[4],N=T.length,V=M.length,X=P.length,Y=R.length,z=L.length,F="\\",H="?",J="*",K="!",Q="|",W="#",Z="{",ll="}",nl=".",el=":",tl="@",ul=null,ol=0,al=0,rl=0,il=0,sl=l.length;for(u=!0===u,m=new s({type:0,val:"",algn:""}),A={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},I=m,U=null,C=null,O={},$=null,D={},j=null,c=null,b="",_=!1,S=0;sl>S;)if(_=!1,x=l[y](S),F===x&&(_=!0,S+=1),T===l.substr(S,N)){if(S+=N,_){b+=T;continue}b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b=""}else if(M===l.substr(S,V)){if(S+=V,_){b+=M;continue}if(d=b,b="",-1<(g=d.indexOf(Q))?(ul=d.slice(g+1),d=d.slice(0,g)):ul=null,v=u?sl>S?l[y](S):"":d[y](0),H===v||J===v)al=1,J===v?(r=1,f=-1):(r=0,f=0),u?(S+=1,sl>S&&K===l[y](S)?(ol=1,S+=1):ol=0):K===d[y](1)?(ol=1,d=d.slice(2)):(ol=0,d=d.slice(1));else if(Z===v){if(u){for(b="",k=S+1,G=sl;G>k&&ll!==l[y](k);)b+=l[y](k++);S=k+1}else{for(b="",k=1,G=d.length;G>k&&ll!==d[y](k);)b+=d[y](k++);d=d.slice(k+1)}b=b.split(","),b.length>1?(r=w(b[0]),r=r.length?0|+r:0,f=w(b[1]),f=f.length?0|+f:-1,al=1):(r=w(b[0]),r=r.length?0|+r:0,f=r,al=0),b="",ol=0}else al=0,ol=0,r=0,f=0;if(ol&&null===ul&&(ul=""),v=d[y](0),tl===v?(rl=1,d=d.slice(1)):rl=0,v=d[y](0),nl===v?(il=1,d=d.slice(1)):il=0,p=-1<d.indexOf(el)?d.split(el):[d,null],d=p[0],p=p[1],a=-1<d.indexOf(nl)?d.split(nl):null,$&&!n(D,$)&&(D[$]={}),L+P===l.substr(S,z+X)&&(S+=z,p=p&&p.length?p:"grtpl--"+t(),j=p,$&&d.length&&(D[$][d]=p)),!d.length)continue;null==p&&$&&n(D,$)&&n(D[$],d)&&(p=D[$][d]),al&&!A.opt?(A.name=d,A.key=a,A.stpl=p,A.dval=ul,A.opt=al,A.neg=ol,A.algn=rl,A.loc=il,A.start=r,A.end=f,C=new i(null,[d,a,ol,r,f,al,il])):al?(r!==f&&A.start===A.end&&(A.name=d,A.key=a,A.stpl=p,A.dval=ul,A.opt=al,A.neg=ol,A.algn=rl,A.loc=il,A.start=r,A.end=f),C=new i(C,[d,a,ol,r,f,al,il])):al||null!==A.name||(A.name=d,A.key=a,A.stpl=p,A.dval=ul,A.opt=0,A.neg=ol,A.algn=rl,A.loc=il,A.start=r,A.end=f,C=new i(null,[d,a,ol,r,f,0,il])),0===m.node.type&&(m.node.algn=o(m.node.val,0,m.node.val.length)),m=new s({type:1,name:d,key:a,stpl:p,dval:ul,opt:al,algn:rl,loc:il,start:r,end:f},m)}else if(P===l.substr(S,X)){if(S+=X,_){b+=P;continue}if(b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b="",W===l[y](S)){for(k=S+1,G=sl;G>k&&W+R!==l.substr(k,Y+1);)b+=l[y](k++);S=k+Y+1,0===m.node.type&&(m.node.algn=o(m.node.val,0,m.node.val.length)),m=new s({type:-100,val:b},m),b="";continue}c=new i(c,[m,U,A,C,$,j]),j&&($=j),j=null,A={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},C=null,m=new s({type:0,val:"",algn:""}),U=m}else if(R===l.substr(S,Y)){if(S+=Y,_){b+=R;continue}h=m,q=U,B=A,E=C,c?(m=c.value[0],U=c.value[1],A=c.value[2],C=c.value[3],$=c.value[4],j=c.value[5],c=c.prev):m=null,b.length&&(0===h.node.type?h.node.val+=b:h=new s({type:0,val:b,algn:""},h)),b="",j?(O[j]=new s({type:2,name:B.name,key:B.key,loc:B.loc,algn:B.algn,start:B.start,end:B.end,opt_args:null,tpl:q}),j=null):(0===m.node.type&&(m.node.algn=o(m.node.val,0,m.node.val.length)),m=new s({type:-1,name:B.name,key:B.key,loc:B.loc,algn:B.algn,start:B.start,end:B.end,opt_args:E,tpl:q},m))}else x=l[y](S++),"\n"===x?(b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b="",0===m.node.type&&(m.node.algn=o(m.node.val,0,m.node.val.length)),m=new s({type:100,val:"\n"},m)):b+=x;return b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),0===m.node.type&&(m.node.algn=o(m.node.val,0,m.node.val.length)),[I,O]}function p(l,n,e,t,o,a,i){var s,f,p,d,c,v,y,m,h=null,b="";if(-1===n.type){if(s=n.opt_args,s&&s.value[5])for(;s;){if(f=s.value,p=r(l,f[1],[String(f[0])],f[6]?null:i),null===h&&n.name===f[0]&&(h=p),0===f[2]&&null==p||1===f[2]&&null!=p)return"";s=s.prev}}else h=r(l,n.key,[String(n.name)],n.loc?null:i);if(d=u(h),m=d?h.length:-1,d&&m>n.start)for(c=n.start,v=-1===n.end?m-1:Math.min(n.end,m-1),y=c;v>=y;y++)b+=g(l,n.tpl,e,t,y,a,i);else d||n.start!==n.end||(b=g(l,n.tpl,e,t,null,a,i));return b}function d(l,e,t,o,i,s,f){var d,g,v,y,m="";if(e.stpl&&(n(t,e.stpl)||n(c.subGlobal,e.stpl)||n(o,e.stpl)||n(o,"*")||n(c.fnGlobal,e.stpl)||n(c.fnGlobal,"*")))if(d=r(l,e.key,[String(e.name)],e.loc?null:f),n(t,e.stpl)||n(c.subGlobal,e.stpl))null==i||0===i&&e.start===e.end&&e.opt||!u(d)||(d=i<d.length?d[i]:null),null==d&&null!==e.dval?m=e.dval:(v=n(t,e.stpl)?t[e.stpl].node:c.subGlobal[e.stpl].node,g={},null!=d&&(u(d)?g[v.name]=d:g=d),m=p(g,v,t,o,null,e.algn?s:"",null==f?l:f));else{if(y=null,n(o,e.stpl)?y=o[e.stpl]:n(o,"*")?y=o["*"]:n(c.fnGlobal,e.stpl)?y=c.fnGlobal[e.stpl]:c.fnGlobal["*"]&&(y=c.fnGlobal["*"]),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),"function"==typeof y){var h={symbol:e,index:i,currentArguments:l,originalArguments:f,alignment:s};d=y(d,h)}else d=String(y);m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=a(m,s))}else e.opt&&null!==e.dval?m=e.dval:(d=r(l,e.key,[String(e.name)],e.loc?null:f),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=a(m,s)));return m}function g(l,n,e,t,u,o,a){o=o||"";for(var r,i=o,s="";n;)r=n.node.type,-1===r?s+=p(l,n.node,e,t,u,n.node.algn?i:o,a):1===r?s+=d(l,n.node,e,t,u,n.node.algn?i:o,a):0===r?(i+=n.node.algn,s+=n.node.val):100===r&&(i=o,s+="\n"+o),n=n.next;return s}function c(l,n,e){var t=this;return t instanceof c?(t.id=null,t.tpl=null,t.fn={},void(t._args=[l||"",n||c.defaultDelims,e||!1])):new c(l,n,e)}var v="prototype",y="charAt",m=Object[v].hasOwnProperty,h=Object[v].toString,b=/^\s+|\s+$/g,w=String[v].trim?function(l){return l.trim()}:function(l){return l.replace(b,"")};return t.GUID=0,c.VERSION="3.0.0",c.defaultDelims=["<",">","[","]",":="],c.fnGlobal={},c.subGlobal={},c.guid=t,c.multisplit=f,c.align=a,c.main=g,c[v]={constructor:c,id:null,tpl:null,fn:null,_args:null,dispose:function(){var l=this;return l.id=null,l.tpl=null,l.fn=null,l._args=null,l},parse:function(){var l=this;return null===l.tpl&&null!==l._args&&(l.tpl=c.multisplit(l._args[0],l._args[1],l._args[2]),l._args=null),l},render:function(l){var n=this;return null===n.tpl&&n.parse(),c.main(null==l?{}:l,n.tpl[0],n.tpl[1],n.fn)}},c});