/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 2.1.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(n,l,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[l])&&(n[l]=n.$deps[l]=e.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[l]=e.call(n)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(l,[],function(t){t(l,e.call(n))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(l)?define(l,["module"],function(l){return e.moduleUri=l.uri,e.call(n)}):l in n||(n[l]=e.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[l]})}(this,"GrammarTemplate",function(n){"use strict";function l(){return""+(new Date).getTime()+"--"+ ++m}function e(n){return n instanceof Array||"[object Array]"===d.call(n)}function t(n,l,e,t){var u,r,i,s,o=0;if(l)for(u=n,r=l.length,i=0,o=1;r>i;){if(s=l[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=n,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&null!=t&&t!==n){if(l)for(u=t,r=l.length,i=0,o=1;r>i;){if(s=l[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=t,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}}return o?u:null}function u(n,l){this.prev=n||null,this.value=l||null}function r(n,l){l&&(l.next=this),this.node=n||null,this.prev=l||null,this.next=null}function i(n,e){var t,i,s,o,a,p,f,d,g,m,v,h,k,w,S,b,_,x,O,$,j,C,D,I,q,A,E,T=e[0],B=e[1],M=e[2],R=e[3],G=e[4],L=T.length,N=B.length,P=M.length,U=R.length,V=G.length,X="\\",Y="?",z="*",F="!",H="|",J="{",K="}",Q=".",W=":",Z=null,nn=0,ln=0,en=n.length;for(g=new r({type:0,val:""}),j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},D=g,I=null,C=null,_={},O=null,x={},$=null,f=null,v="",S=!1,h=0;en>h;)if(b=n[c](h),X===b&&(S=!S,h+=1),T===n.substr(h,L)){if(h+=L,S){v+=T,S=!1;continue}v.length&&(0===g.node.type?g.node.val+=v:g=new r({type:0,val:v},g)),v=""}else if(B===n.substr(h,N)){if(h+=N,S){v+=B,S=!1;continue}if(a=v,v="",-1<(p=a.indexOf(H))?(Z=a.slice(p+1),a=a.slice(0,p)):Z=null,d=a[c](0),Y===d||z===d)ln=1,z===d?(i=1,s=-1):(i=0,s=0),a=a.slice(1),F===a[c](0)?(nn=1,a=a.slice(1)):nn=0;else if(J===d){for(v="",k=1,w=a.length;w>k&&K!==a[c](k);)v+=a[c](k++);a=a.slice(k+1),v=v.split(","),v.length>1?(i=y(v[0]),i=i.length?parseInt(i,10)||0:0,s=y(v[1]),s=s.length?parseInt(s,10)||0:-1,ln=1):(i=y(v[0]),i=i.length?parseInt(i,10)||0:0,s=i,ln=0),v="",nn=0}else ln=0,nn=0,i=0,s=0;if(nn&&null===Z&&(Z=""),o=-1<a.indexOf(W)?a.split(W):[a,null],a=o[0],o=o[1],t=-1<a.indexOf(Q)?a.split(Q):null,O&&!x[O]&&(x[O]={}),G+M===n.substr(h,V+P)&&(h+=V,o=o&&o.length?o:"grtpl--"+l(),$=o,O&&a.length&&(x[O][a]=o)),!a.length)continue;null==o&&O&&x[O]&&x[O][a]&&(o=x[O][a]),ln&&!j.opt?(j.name=a,j.key=t,j.stpl=o,j.dval=Z,j.opt=ln,j.neg=nn,j.start=i,j.end=s,C=new u(null,[a,t,nn,i,s])):ln?C=new u(C,[a,t,nn,i,s]):ln||null!==j.name||(j.name=a,j.key=t,j.stpl=o,j.dval=Z,j.opt=0,j.neg=nn,j.start=i,j.end=s,C=new u(null,[a,t,nn,i,s])),g=new r({type:1,name:a,key:t,stpl:o,dval:Z,opt:ln,start:i,end:s},g)}else if(M===n.substr(h,P)){if(h+=P,S){v+=M,S=!1;continue}v.length&&(0===g.node.type?g.node.val+=v:g=new r({type:0,val:v},g)),v="",f=new u(f,[g,I,j,C,O,$]),$&&(O=$),$=null,j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},C=null,g=new r({type:0,val:""}),I=g}else if(R===n.substr(h,U)){if(h+=U,S){v+=R,S=!1;continue}m=g,q=I,A=j,E=C,f?(g=f.value[0],I=f.value[1],j=f.value[2],C=f.value[3],O=f.value[4],$=f.value[5],f=f.prev):g=null,v.length&&(0===m.node.type?m.node.val+=v:m=new r({type:0,val:v},m)),v="",$?(_[$]=new r({type:2,name:A.name,key:A.key,start:0,end:0,opt_args:null,tpl:q}),$=null):g=new r({type:-1,name:A.name,key:A.key,start:A.start,end:A.end,opt_args:E,tpl:q},g)}else v+=X===b?b:n[c](h++);return v.length&&(0===g.node.type?g.node.val+=v:g=new r({type:0,val:v},g)),[D,_]}function s(n,l,u,r,i,s){var o,p,f,d,c,g,y,m,v=null,h="";if(-1===l.type){if(o=l.opt_args,!o)return"";for(;o;){if(p=o.value,f=t(n,p[1],[String(p[0])],s),null===v&&l.name===p[0]&&(v=f),0===p[2]&&null==f||1===p[2]&&null!=f)return"";o=o.prev}}else v=t(n,l.key,[String(l.name)],s);if(d=e(v),m=d?v.length:-1,d&&m>l.start)for(c=l.start,g=-1===l.end?m-1:Math.min(l.end,m-1),y=c;g>=y;y++)h+=a(n,l.tpl,u,r,y,s);else d||l.start!==l.end||(h=a(n,l.tpl,u,r,null,s));return h}function o(n,l,u,r,i,o){var a,p,f,d="";return(u||r)&&l.stpl&&(u[l.stpl]||r[l.stpl])?(a=t(n,l.key,[String(l.name)],o),r&&r[l.stpl]?(e(a)&&(i=null!=i?i:l.start,a=i<a.length?a[i]:null),a="function"==typeof r[l.stpl]?r[l.stpl](a,i,n,o,l):r[l.stpl]||null,d=null==a&&null!==l.dval?l.dval:String(a)):(null==i||0===i&&l.opt||!e(a)||(a=a[i]),null==a&&null!==l.dval?d=l.dval:(f=u[l.stpl].node,p={},null!=a&&(e(a)?p[f.name]=a:p=a),d=s(p,f,u,r,null,null==o?n:o)))):l.opt&&null!==l.dval?d=l.dval:(a=t(n,l.key,[String(l.name)],o),e(a)&&(i=null!=i?i:l.start,a=i<a.length?a[i]:null),d=null==a&&null!==l.dval?l.dval:String(a)),d}function a(n,l,e,t,u,r){for(var i,a="";l;)i=l.node.type,a+=-1===i?s(n,l.node,e,t,u,r):1===i?o(n,l.node,e,t,u,r):l.node.val,l=l.next;return a}function p(n,l){var e=this;return e instanceof p?(e.id=null,e.tpl=null,e.fn={},void(e._args=[n||"",l||p.defaultDelims])):new p(n,l)}var f="prototype",d=Object[f].toString,c="charAt",g=/^\s+|\s+$/g,y=String[f].trim?function(n){return n.trim()}:function(n){return n.replace(g,"")},m=0;return p.VERSION="2.1.0",p.defaultDelims=["<",">","[","]",":="],p.guid=l,p.multisplit=i,p.main=a,p[f]={constructor:p,id:null,tpl:null,fn:null,_args:null,dispose:function(){var n=this;return n.id=null,n.tpl=null,n.fn=null,n._args=null,n},parse:function(){var n=this;return null===n.tpl&&(n.tpl=p.multisplit(n._args[0],n._args[1]),n._args=null),n},render:function(n){var l=this;return null===l.tpl&&l.parse(),p.main(null==n?{}:n,l.tpl[0],l.tpl[1],l.fn)}},p});