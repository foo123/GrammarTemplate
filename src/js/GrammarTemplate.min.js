/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 2.1.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(l,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(l.$deps=l.$deps||{})&&(l.EXPORTED_SYMBOLS=[n])&&(l[n]=l.$deps[n]=e.call(l)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(l)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,e.call(l))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(l)}):n in l||(l[n]=e.call(l)||1)&&"function"==typeof define&&define.amd&&define(function(){return l[n]})}(this,"GrammarTemplate",function(l){"use strict";function n(){return""+(new Date).getTime()+"--"+ ++m}function e(l){return l instanceof Array||"[object Array]"===d.call(l)}function t(l,n,e,t){var u,r,i,s,o=0;if(n)for(u=l,r=n.length,i=0,o=1;r>i;){if(s=n[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=l,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&null!=t&&t!==l){if(n)for(u=t,r=n.length,i=0,o=1;r>i;){if(s=n[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=t,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}}return o?u:null}function u(l,n){this.prev=l||null,this.value=n||null}function r(l,n){n&&(n.next=this),this.node=l||null,this.prev=n||null,this.next=null}function i(l,e,t){var i,s,o,a,p,f,d,g,m,v,h,b,k,S,w,_,x,O,$,j,C,D,G,q,A,E,T,B,I=e[0],M=e[1],R=e[2],L=e[3],N=e[4],P=I.length,U=M.length,V=R.length,X=L.length,Y=N.length,z="\\",F="?",H="*",J="!",K="|",Q="{",W="}",Z=".",ll=":",nl=null,el=0,tl=0,ul=l.length;for(t=!0===t,v=new r({type:0,val:""}),D={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},q=v,A=null,G=null,O={},j=null,$={},C=null,g=null,b="",_=!1,k=0;ul>k;)if(x=l[c](k),z===x&&(_=!_,k+=1),I===l.substr(k,P)){if(k+=P,_){b+=I,_=!1;continue}b.length&&(0===v.node.type?v.node.val+=b:v=new r({type:0,val:b},v)),b=""}else if(M===l.substr(k,U)){if(k+=U,_){b+=M,_=!1;continue}if(s=0,f=b,b="",-1<(d=f.indexOf(K))?(nl=f.slice(d+1),f=f.slice(0,d)):nl=null,t?(m=l.substr(k,2),z+F===m||z+H===m||z+Q===m?(k+=1,m="",s=1):m=ul>k?l[c](k):""):m=f[c](0),F===m||H===m)tl=1,H===m?(o=1,a=-1):(o=0,a=0),t?(k+=1,ul>k&&J===l[c](k)?(el=1,k+=1):el=0):(f=f.slice(1),J===f[c](0)?(el=1,f=f.slice(1)):el=0);else if(Q===m){if(t){for(b="",S=k+1,w=ul;w>S&&W!==l[c](S);)b+=l[c](S++);k=S}else{for(b="",S=1,w=f.length;w>S&&W!==f[c](S);)b+=f[c](S++);f=f.slice(S+1)}b=b.split(","),b.length>1?(o=y(b[0]),o=o.length?0|+o:0,a=y(b[1]),a=a.length?0|+a:-1,tl=1):(o=y(b[0]),o=o.length?0|+o:0,a=o,tl=0),b="",el=0}else tl=0,el=0,o=0,a=0;if(el&&null===nl&&(nl=""),p=-1<f.indexOf(ll)?f.split(ll):[f,null],f=p[0],p=p[1],i=-1<f.indexOf(Z)?f.split(Z):null,j&&!$[j]&&($[j]={}),s||N+R!==l.substr(k,Y+V)||(k+=Y,p=p&&p.length?p:"grtpl--"+n(),C=p,j&&f.length&&($[j][f]=p)),!f.length)continue;null==p&&j&&$[j]&&$[j][f]&&(p=$[j][f]),tl&&!D.opt?(D.name=f,D.key=i,D.stpl=p,D.dval=nl,D.opt=tl,D.neg=el,D.start=o,D.end=a,G=new u(null,[f,i,el,o,a])):tl?G=new u(G,[f,i,el,o,a]):tl||null!==D.name||(D.name=f,D.key=i,D.stpl=p,D.dval=nl,D.opt=0,D.neg=el,D.start=o,D.end=a,G=new u(null,[f,i,el,o,a])),v=new r({type:1,name:f,key:i,stpl:p,dval:nl,opt:tl,start:o,end:a},v)}else if(R===l.substr(k,V)){if(k+=V,_){b+=R,_=!1;continue}b.length&&(0===v.node.type?v.node.val+=b:v=new r({type:0,val:b},v)),b="",g=new u(g,[v,A,D,G,j,C]),C&&(j=C),C=null,D={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},G=null,v=new r({type:0,val:""}),A=v}else if(L===l.substr(k,X)){if(k+=X,_){b+=L,_=!1;continue}h=v,E=A,T=D,B=G,g?(v=g.value[0],A=g.value[1],D=g.value[2],G=g.value[3],j=g.value[4],C=g.value[5],g=g.prev):v=null,b.length&&(0===h.node.type?h.node.val+=b:h=new r({type:0,val:b},h)),b="",C?(O[C]=new r({type:2,name:T.name,key:T.key,start:0,end:0,opt_args:null,tpl:E}),C=null):v=new r({type:-1,name:T.name,key:T.key,start:T.start,end:T.end,opt_args:B,tpl:E},v)}else b+=z===x?x:l[c](k++);return b.length&&(0===v.node.type?v.node.val+=b:v=new r({type:0,val:b},v)),[q,O]}function s(l,n,u,r,i,s){var o,p,f,d,c,g,y,m,v=null,h="";if(-1===n.type){if(o=n.opt_args,!o)return"";for(;o;){if(p=o.value,f=t(l,p[1],[String(p[0])],s),null===v&&n.name===p[0]&&(v=f),0===p[2]&&null==f||1===p[2]&&null!=f)return"";o=o.prev}}else v=t(l,n.key,[String(n.name)],s);if(d=e(v),m=d?v.length:-1,d&&m>n.start)for(c=n.start,g=-1===n.end?m-1:Math.min(n.end,m-1),y=c;g>=y;y++)h+=a(l,n.tpl,u,r,y,s);else d||n.start!==n.end||(h=a(l,n.tpl,u,r,null,s));return h}function o(l,n,u,r,i,o){var a,f,d,c,g="";return n.stpl&&(u&&u[n.stpl]||r&&r[n.stpl]||p.fnGlobal[n.stpl])?(a=t(l,n.key,[String(n.name)],o),u&&u[n.stpl]?(null==i||0===i&&n.opt||!e(a)||(a=a[i]),null==a&&null!==n.dval?g=n.dval:(d=u[n.stpl].node,f={},null!=a&&(e(a)?f[d.name]=a:f=a),g=s(f,d,u,r,null,null==o?l:o))):(c=r&&r[n.stpl]?r[n.stpl]:p.fnGlobal[n.stpl]?p.fnGlobal[n.stpl]:null,e(a)&&(i=null!=i?i:n.start,a=i<a.length?a[i]:null),a="function"==typeof c?c(a,i,l,o,n):String(c),g=null==a&&null!==n.dval?n.dval:String(a))):n.opt&&null!==n.dval?g=n.dval:(a=t(l,n.key,[String(n.name)],o),e(a)&&(i=null!=i?i:n.start,a=i<a.length?a[i]:null),g=null==a&&null!==n.dval?n.dval:String(a)),g}function a(l,n,e,t,u,r){for(var i,a="";n;)i=n.node.type,a+=-1===i?s(l,n.node,e,t,u,r):1===i?o(l,n.node,e,t,u,r):n.node.val,n=n.next;return a}function p(l,n,e){var t=this;return t instanceof p?(t.id=null,t.tpl=null,t.fn={},void(t._args=[l||"",n||p.defaultDelims,e||!1])):new p(l,n,e)}var f="prototype",d=Object[f].toString,c="charAt",g=/^\s+|\s+$/g,y=String[f].trim?function(l){return l.trim()}:function(l){return l.replace(g,"")},m=0;return p.VERSION="2.1.0",p.defaultDelims=["<",">","[","]",":="],p.fnGlobal={},p.guid=n,p.multisplit=i,p.main=a,p[f]={constructor:p,id:null,tpl:null,fn:null,_args:null,dispose:function(){var l=this;return l.id=null,l.tpl=null,l.fn=null,l._args=null,l},parse:function(){var l=this;return null===l.tpl&&null!==l._args&&(l.tpl=p.multisplit(l._args[0],l._args[1],l._args[2]),l._args=null),l},render:function(l){var n=this;return null===n.tpl&&n.parse(),p.main(null==l?{}:l,n.tpl[0],n.tpl[1],n.fn)}},p});