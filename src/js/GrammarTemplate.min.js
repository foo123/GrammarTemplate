/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 2.0.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(e,n,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=l.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=l.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,l.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return l.moduleUri=n.uri,l.call(e)}):n in e||(e[n]=l.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"GrammarTemplate",function(e){"use strict";function n(){return"grtpl--"+(new Date).getTime()+"--"+ ++v}function l(e){return e instanceof Array||"[object Array]"===c.call(e)}function t(e,n){for(var l,t=e,u=n.length,r=0;u>r;){if(l=n[r++],null==t||null==t[l])return null;t=t[l]}return t}function u(e,n){this.prev=e||null,this.value=n||null}function r(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function s(e,l){var t,s,i,a,o,p,d,f,c,y,v,h,w,_,k,b,S,x,O,$,j,C,D,I,q,A,E,T=l[0],B=l[1],M=l[2],P=l[3],R=l[4],G=T.length,L=B.length,N=M.length,U=P.length,V=R.length,X="\\",Y="?",z="*",F="!",H="|",J="{",K="}",Q=".",W=":",Z=null,ee=0,ne=0,le=e.length;for(c=new r({type:0,val:""}),j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},D=c,I=null,C=null,S={},O=null,x={},$=null,d=null,v="",k=!1,h=0;le>h;)if(b=e[m](h),X===b&&(k=!k,h+=1),T===e.substr(h,G)){if(h+=G,k){v+=T,k=!1;continue}v.length&&(0===c.node.type?c.node.val+=v:c=new r({type:0,val:v},c)),v=""}else if(B===e.substr(h,L)){if(h+=L,k){v+=B,k=!1;continue}if(o=v,v="",-1<(p=o.indexOf(H))?(Z=o.slice(p+1),o=o.slice(0,p)):Z=null,f=o[m](0),Y===f||z===f)ne=1,z===f?(s=1,i=-1):(s=0,i=0),o=o.slice(1),F===o[m](0)?(ee=1,o=o.slice(1)):ee=0;else if(J===f){for(v="",w=1,_=o.length;_>w&&K!==o[m](w);)v+=o[m](w++);o=o.slice(w+1),v=v.split(","),v.length>1?(s=g(v[0]),s=s.length?parseInt(s,10)||0:0,i=g(v[1]),i=i.length?parseInt(i,10)||0:-1,ne=1):(s=g(v[0]),s=s.length?parseInt(s,10)||0:0,i=s,ne=0),v="",ee=0}else ne=0,ee=0,s=0,i=0;if(ee&&null===Z&&(Z=""),a=-1<o.indexOf(W)?o.split(W):[o,null],o=a[0],a=a[1],t=-1<o.indexOf(Q)?o.split(Q):null,O&&!x[O]&&(x[O]={}),R+M===e.substr(h,V+N)&&(h+=V,a=a&&a.length?a:n(),$=a,O&&o.length&&(x[O][o]=a)),!o.length)continue;null==a&&O&&x[O]&&x[O][o]&&(a=x[O][o]),ne&&!j.opt?(j.name=o,j.key=t,j.stpl=a,j.dval=Z,j.opt=ne,j.neg=ee,j.start=s,j.end=i,C=new u(null,[o,t,ee,s,i])):ne?C=new u(C,[o,t,ee,s,i]):ne||null!==j.name||(j.name=o,j.key=t,j.stpl=a,j.dval=Z,j.opt=0,j.neg=ee,j.start=s,j.end=i,C=new u(null,[o,t,ee,s,i])),c=new r({type:1,name:o,key:t,stpl:a,dval:Z,start:s,end:i},c)}else if(M===e.substr(h,N)){if(h+=N,k){v+=M,k=!1;continue}v.length&&(0===c.node.type?c.node.val+=v:c=new r({type:0,val:v},c)),v="",d=new u(d,[c,I,j,C,O,$]),$&&(O=$),$=null,j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},C=null,c=new r({type:0,val:""}),I=c}else if(P===e.substr(h,U)){if(h+=U,k){v+=P,k=!1;continue}y=c,q=I,A=j,E=C,d?(c=d.value[0],I=d.value[1],j=d.value[2],C=d.value[3],O=d.value[4],$=d.value[5],d=d.prev):c=null,v.length&&(0===y.node.type?y.node.val+=v:y=new r({type:0,val:v},y)),v="",$?(S[$]=new r({type:2,name:A.name,key:A.key,start:0,end:0,opt_args:null,tpl:q}),$=null):c=new r({type:-1,name:A.name,key:A.key,start:A.start,end:A.end,opt_args:E,tpl:q},c)}else v+=X===b?b:e[m](h++);return v.length&&(0===c.node.type?c.node.val+=v:c=new r({type:0,val:v},c)),[D,S]}function i(e,n,u,r){var s,i,a,p,d,c,m,y="";if(-1===u.type){if(s=u.opt_args,!s)return"";for(;s;){if(i=s.value,a=i[1]?t(n,i[1]):n[i[0]],0===i[2]&&null==a||1===i[2]&&null!=a)return"";s=s.prev}}if(u.key?(a=t(n,u.key),null==a&&n[f](u.name)&&(a=n[u.name])):a=n[u.name],p=l(a),p&&a.length>u.start)for(d=u.start,c=-1===u.end?a.length-1:Math.min(u.end,a.length-1),m=d;c>=m;m++)y+=o(e,n,u.tpl,m);else p||u.start!==u.end||(y=o(e,n,u.tpl,null));return y}function a(e,n,u,r){var s,a,o,p="";return e&&u.stpl&&e[u.stpl]?(u.key?(s=t(n,u.key),null==s&&n[f](u.name)&&(s=n[u.name])):s=n[u.name],null!=r&&l(s)&&(s=s[r]),null==s&&null!==u.dval?p=u.dval:(o=e[u.stpl].node,a={},null!=s&&(l(s)?a[o.name]=s:a=s),p=i(e,a,o,null))):(u.key?(s=t(n,u.key),null==s&&n[f](u.name)&&(s=n[u.name])):s=n[u.name],l(s)&&(s=null!=r?s[r]:s[u.start]),p=null==s&&null!==u.dval?u.dval:String(s)),p}function o(e,n,l,t){for(var u,r="";l;)u=l.node.type,r+=-1===u?i(e,n,l.node,t):1===u?a(e,n,l.node,t):l.node.val,l=l.next;return r}function p(e,n){var l=this;return l instanceof p?(l.id=null,l.tpl=null,l._args=[e||"",n||p.defaultDelims],void(l._parsed=!1)):new p(e,n)}var d="prototype",f="hasOwnProperty",c=Object[d].toString,m="charAt",y=/^\s+|\s+$/g,g=String[d].trim?function(e){return e.trim()}:function(e){return e.replace(y,"")},v=0;return p.VERSION="2.0.0",p.defaultDelims=["<",">","[","]",":="],p.multisplit=s,p.main=o,p[d]={constructor:p,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},parse:function(){var e=this;return!1===e._parsed&&(e._parsed=!0,e.tpl=p.multisplit(e._args[0],e._args[1]),e._args=null),e},render:function(e){var n=this;return!1===n._parsed&&n.parse(),p.main(n.tpl[1],null==e?{}:e,n.tpl[0])}},p});