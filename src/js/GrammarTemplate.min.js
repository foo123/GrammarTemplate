/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 1.0.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(e,n,t){"use strict";var l;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=l=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return l})}(this,"GrammarTemplate",function(){"use strict";function e(e){return e instanceof Array||"[object Array]"===r.call(e)}var n,t="prototype",l="hasOwnProperty",r=Object[t].toString,s="charAt",u=/^\s+|\s+$/g,i=String[t].trim?function(e){return e.trim()}:function(e){return e.replace(u,"")};return n=function o(e,n){var t=this;return t instanceof o?(t.id=null,t.tpl=null,t._args=[e||"",n||o.defaultDelims],void(t._parsed=!1)):new o(e,n)},n.VERSION="1.0.0",n.defaultDelims=["<",">","[","]"],n.multisplit=function(e,n){var t,l,r,u,o,p,f,a,c,h,g,d,m=n[0],y=n[1],_=n[2],b=n[3],v=m.length,O=y.length,j=_.length,C=b.length,I="?",S="*",q="!",x="|",D="{",A="}",E=null,w=0,B=0,M=e.length;for(h=0,f=[[],null,0,0,0,0,null],o=[],c="";M>h;)if(m===e.substr(h,v))h+=v,c.length&&f[0].push([0,c]),c="";else if(y===e.substr(h,O)){if(h+=O,r=c,c="",-1<(u=r.indexOf(x))?(E=r.slice(u+1),r=r.slice(0,u)):E=null,p=r[s](0),I===p||S===p)B=1,S===p?(t=1,l=-1):(t=0,l=0),r=r.slice(1),q===r[s](0)?(w=1,r=r.slice(1)):w=0;else if(D===p){for(c="",g=1,d=r.length;d>g&&A!==r[s](g);)c+=r[s](g++);r=r.slice(g+1),c=c.split(","),c.length>1?(t=i(c[0]),t=t.length?parseInt(t,10)||0:0,l=i(c[1]),l=l.length?parseInt(l,10)||0:-1,B=1):(t=i(c[0]),t=t.length?parseInt(t,10)||0:0,l=t,B=0),c="",w=0}else B=0,w=0,t=0,l=0;w&&null===E&&(E=""),B&&!f[2]?(f[1]=r,f[2]=B,f[3]=w,f[4]=t,f[5]=l,f[6]=[[r,w,t,l]]):B?f[6].push([r,w,t,l]):B||null!==f[1]||(f[1]=r,f[2]=0,f[3]=w,f[4]=t,f[5]=l,f[6]=[[r,w,t,l]]),f[0].push([1,r,E,B,w,t,l])}else _===e.substr(h,j)?(h+=j,c.length&&f[0].push([0,c]),c="",o.push(f),f=[[],null,0,0,0,0,null]):b===e.substr(h,C)?(h+=C,a=f,f=o.pop(),c.length&&a[0].push([0,c]),c="",f[0].push([-1,a[1],a[2],a[3],a[4],a[5],a[6],a[0]])):c+=e[s](h++);return c.length&&f[0].push([0,c]),f[0]},n[t]={constructor:n,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},parse:function(){var e=this;return!1===e._parsed&&(e.tpl=n.multisplit(e._args[0],e._args[1]),e._args=null,e._parsed=!0),e},render:function(n){var t=this;!1===t._parsed&&t.parse(),n=n||{};var r,s,u,i,o,p,f,a,c,h,g,d,m,y=t.tpl,_=y.length,b=[],v=Math.min,O=null,j=0,C="";for(u=0;_>u||b.length;)if(u>=_)r=b.pop(),y=r[0],u=r[1],_=r[2],O=r[3]||null,j=r[4]||0;else{if(i=y[u],o=i[0],p=i[1],-1===o){if(c=i[6],c&&c.length){for(h=!0,g=0,d=c.length;d>g;g++)if(m=c[g],0===m[1]&&!n[l](m[0])||1===m[1]&&n[l](m[0])){h=!1;break}if(h){if(1===i[3]){b.push([y,u+1,_,O,j]),y=i[7],u=0,_=y.length,O=null,j=0;continue}if(s=e(n[p]),s&&i[4]!==i[5]&&n[p].length>i[4]){if(f=i[4],a=-1===i[5]?n[p].length-1:v(i[5],n[p].length-1),a>=f){for(b.push([y,u+1,_,O,j]),y=i[7],u=0,_=y.length,O=p,j=a;j>f;j--)b.push([y,0,_,O,j]);j=f;continue}}else if(!s&&i[4]===i[5]){b.push([y,u+1,_,O,j]),y=i[7],u=0,_=y.length,O=p,j=0;continue}}}}else C+=1===o?n[l](p)||null===i[2]?e(n[p])?p===O?n[p][i[5]===i[6]?i[5]:j]:n[p][i[5]]:n[p]:i[2]:p;u++}return C}},n});