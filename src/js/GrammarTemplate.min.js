/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 2.0.1
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(e,n,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=l.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=l.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,l.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return l.moduleUri=n.uri,l.call(e)}):n in e||(e[n]=l.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"GrammarTemplate",function(e){"use strict";function n(){return""+(new Date).getTime()+"--"+ ++g}function l(e){return e instanceof Array||"[object Array]"===d.call(e)}function t(e,n,l,t){var u,r,i,s,a=0;if(n)for(u=e,r=n.length,i=0,a=1;r>i;){if(s=n[i++],null==u||null==u[s]){a=0;break}u=u[s]}if(!a&&l)for(u=e,r=l.length,i=0,a=1;r>i;){if(s=l[i++],null==u||null==u[s]){a=0;break}u=u[s]}if(!a&&null!=t&&t!==e){if(n)for(u=t,r=n.length,i=0,a=1;r>i;){if(s=n[i++],null==u||null==u[s]){a=0;break}u=u[s]}if(!a&&l)for(u=t,r=l.length,i=0,a=1;r>i;){if(s=l[i++],null==u||null==u[s]){a=0;break}u=u[s]}}return a?u:null}function u(e,n){this.prev=e||null,this.value=n||null}function r(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function i(e,l){var t,i,s,a,o,p,f,d,m,g,v,h,k,_,w,b,S,x,O,$,j,C,D,I,q,A,E,T=l[0],B=l[1],M=l[2],R=l[3],G=l[4],L=T.length,N=B.length,P=M.length,U=R.length,V=G.length,X="\\",Y="?",z="*",F="!",H="|",J="{",K="}",Q=".",W=":",Z=null,ee=0,ne=0,le=e.length;for(m=new r({type:0,val:""}),j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},D=m,I=null,C=null,S={},O=null,x={},$=null,f=null,v="",w=!1,h=0;le>h;)if(b=e[c](h),X===b&&(w=!w,h+=1),T===e.substr(h,L)){if(h+=L,w){v+=T,w=!1;continue}v.length&&(0===m.node.type?m.node.val+=v:m=new r({type:0,val:v},m)),v=""}else if(B===e.substr(h,N)){if(h+=N,w){v+=B,w=!1;continue}if(o=v,v="",-1<(p=o.indexOf(H))?(Z=o.slice(p+1),o=o.slice(0,p)):Z=null,d=o[c](0),Y===d||z===d)ne=1,z===d?(i=1,s=-1):(i=0,s=0),o=o.slice(1),F===o[c](0)?(ee=1,o=o.slice(1)):ee=0;else if(J===d){for(v="",k=1,_=o.length;_>k&&K!==o[c](k);)v+=o[c](k++);o=o.slice(k+1),v=v.split(","),v.length>1?(i=y(v[0]),i=i.length?parseInt(i,10)||0:0,s=y(v[1]),s=s.length?parseInt(s,10)||0:-1,ne=1):(i=y(v[0]),i=i.length?parseInt(i,10)||0:0,s=i,ne=0),v="",ee=0}else ne=0,ee=0,i=0,s=0;if(ee&&null===Z&&(Z=""),a=-1<o.indexOf(W)?o.split(W):[o,null],o=a[0],a=a[1],t=-1<o.indexOf(Q)?o.split(Q):null,O&&!x[O]&&(x[O]={}),G+M===e.substr(h,V+P)&&(h+=V,a=a&&a.length?a:"grtpl--"+n(),$=a,O&&o.length&&(x[O][o]=a)),!o.length)continue;null==a&&O&&x[O]&&x[O][o]&&(a=x[O][o]),ne&&!j.opt?(j.name=o,j.key=t,j.stpl=a,j.dval=Z,j.opt=ne,j.neg=ee,j.start=i,j.end=s,C=new u(null,[o,t,ee,i,s])):ne?C=new u(C,[o,t,ee,i,s]):ne||null!==j.name||(j.name=o,j.key=t,j.stpl=a,j.dval=Z,j.opt=0,j.neg=ee,j.start=i,j.end=s,C=new u(null,[o,t,ee,i,s])),m=new r({type:1,name:o,key:t,stpl:a,dval:Z,opt:ne,start:i,end:s},m)}else if(M===e.substr(h,P)){if(h+=P,w){v+=M,w=!1;continue}v.length&&(0===m.node.type?m.node.val+=v:m=new r({type:0,val:v},m)),v="",f=new u(f,[m,I,j,C,O,$]),$&&(O=$),$=null,j={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},C=null,m=new r({type:0,val:""}),I=m}else if(R===e.substr(h,U)){if(h+=U,w){v+=R,w=!1;continue}g=m,q=I,A=j,E=C,f?(m=f.value[0],I=f.value[1],j=f.value[2],C=f.value[3],O=f.value[4],$=f.value[5],f=f.prev):m=null,v.length&&(0===g.node.type?g.node.val+=v:g=new r({type:0,val:v},g)),v="",$?(S[$]=new r({type:2,name:A.name,key:A.key,start:0,end:0,opt_args:null,tpl:q}),$=null):m=new r({type:-1,name:A.name,key:A.key,start:A.start,end:A.end,opt_args:E,tpl:q},m)}else v+=X===b?b:e[c](h++);return v.length&&(0===m.node.type?m.node.val+=v:m=new r({type:0,val:v},m)),[D,S]}function s(e,n,u,r,i){var s,a,p,f,d,c,m,y,g=null,v="";if(-1===n.type){if(s=n.opt_args,!s)return"";for(;s;){if(a=s.value,p=t(e,a[1],[a[0]],i),null===g&&n.name===a[0]&&(g=p),0===a[2]&&null==p||1===a[2]&&null!=p)return"";s=s.prev}}else g=t(e,n.key,[n.name],i);if(f=l(g),y=f?g.length:-1,f&&y>n.start)for(d=n.start,c=-1===n.end?y-1:Math.min(n.end,y-1),m=d;c>=m;m++)v+=o(e,n.tpl,u,m,i);else f||n.start!==n.end||(v=o(e,n.tpl,u,null,i));return v}function a(e,n,u,r,i){var a,o,p,f="";return u&&n.stpl&&u[n.stpl]?(a=t(e,n.key,[n.name],i),null==r||0===r&&n.opt||!l(a)||(a=a[r]),null==a&&null!==n.dval?f=n.dval:(p=u[n.stpl].node,o={},null!=a&&(l(a)?o[p.name]=a:o=a),f=s(o,p,u,null,null==i?e:i))):n.opt&&null!==n.dval?f=n.dval:(a=t(e,n.key,[n.name],i),l(a)&&(r=null!=r?r:n.start,a=r<a.length?a[r]:null),f=null==a&&null!==n.dval?n.dval:String(a)),f}function o(e,n,l,t,u){for(var r,i="";n;)r=n.node.type,i+=-1===r?s(e,n.node,l,t,u):1===r?a(e,n.node,l,t,u):n.node.val,n=n.next;return i}function p(e,n){var l=this;return l instanceof p?(l.id=null,l.tpl=null,l._args=[e||"",n||p.defaultDelims],void(l._parsed=!1)):new p(e,n)}var f="prototype",d=Object[f].toString,c="charAt",m=/^\s+|\s+$/g,y=String[f].trim?function(e){return e.trim()}:function(e){return e.replace(m,"")},g=0;return p.VERSION="2.0.1",p.defaultDelims=["<",">","[","]",":="],p.guid=n,p.multisplit=i,p.main=o,p[f]={constructor:p,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},parse:function(){var e=this;return!1===e._parsed&&(e._parsed=!0,e.tpl=p.multisplit(e._args[0],e._args[1]),e._args=null),e},render:function(e){var n=this;return!1===n._parsed&&n.parse(),p.main(null==e?{}:e,n.tpl[0],n.tpl[1])}},p});