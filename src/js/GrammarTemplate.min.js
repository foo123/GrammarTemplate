/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 3.0.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(l,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(l.$deps=l.$deps||{})&&(l.EXPORTED_SYMBOLS=[n])&&(l[n]=l.$deps[n]=e.call(l)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(l)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,e.call(l))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(l)}):n in l||(l[n]=e.call(l)||1)&&"function"==typeof define&&define.amd&&define(function(){return l[n]})}(this,"GrammarTemplate",function(l){"use strict";function n(l,n){return l&&m.call(l,n)?1:0}function e(l,n,e,t){var u=String(l);if(e=e||"0",t)for(;u.length<n;)u+=e;else for(;u.length<n;)u=e+u;return u}function t(){return t.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(t.GUID.toString(16),4)}function u(l){return l instanceof Array||"[object Array]"===h.call(l)}function a(l,n,e){for(var t,u="";e>n&&(t=l[y](n)," "===t||"\r"===t||"	"===t||"\x0B"===t||"\x00"===t);)u+=t,n+=1;return u}function o(l,n){var e,t,u,a=l.length;if(a&&n.length)for(e="",u=0;a>u;u++)t=l[y](u),e+=t,"\n"===t&&(e+=n);else e=l;return e}function r(l,n,e,t){var u,a,o,r,i=0;if(n)for(u=l,a=n.length,o=0,i=1;a>o;){if(r=n[o++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&e)for(u=l,a=e.length,o=0,i=1;a>o;){if(r=e[o++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&null!=t&&t!==l){if(n)for(u=t,a=n.length,o=0,i=1;a>o;){if(r=n[o++],null==u||null==u[r]){i=0;break}u=u[r]}if(!i&&e)for(u=t,a=e.length,o=0,i=1;a>o;){if(r=e[o++],null==u||null==u[r]){i=0;break}u=u[r]}}return i?u:null}function i(l,n){this.prev=l||null,this.value=n||null}function s(l,n){n&&(n.next=this),this.node=l||null,this.prev=n||null,this.next=null}function f(l,e,u){var o,r,f,p,d,g,c,v,m,h,b,S,k,G,_,x,O,D,$,j,A,C,I,U,q,B,E=e[0],T=e[1],M=e[2],P=e[3],R=E.length,L=T.length,N=M.length,V=P.length,X="\\",Y="?",z="*",F="!",H="|",J="#",K=":=",Q="{",W="}",Z=".",ll=":",nl="@",el=J+P,tl=null,ul=0,al=0,ol=0,rl=0,il=l.length,sl=[E,R,T,L],fl=[M,N,P,V],pl=[null,0,null,0,null,0,null,0];for(u=!0===u,m=new s({type:0,val:"",algn:""}),$={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},A=m,C=null,j=null,_={},O=null,x={},D=null,sl[1]<sl[3]&&(b=sl[0],sl[2]=sl[0],sl[0]=b,S=sl[1],sl[3]=sl[1],sl[1]=S),fl[1]<fl[3]&&(b=fl[0],fl[2]=fl[0],fl[0]=b,S=fl[1],fl[3]=fl[1],fl[1]=S),r=0,f=0,S=0;4>r&&4>f;)sl[r+1]<fl[f+1]?(pl[S]=fl[f],pl[S+1]=fl[f+1],f+=2):(pl[S]=sl[r],pl[S+1]=sl[r+1],r+=2),S+=2;for(;4>r;)pl[S]=sl[r],pl[S+1]=sl[r+1],r+=2,S+=2;for(;4>f;)pl[S]=fl[f],pl[S+1]=fl[f+1],f+=2,S+=2;for(c=null,b="",S=0;il>S;)if(v=l[y](S),X!==v)if(B=null,pl[0]===l.substr(S,pl[1])?B=pl[0]:pl[2]===l.substr(S,pl[3])?B=pl[2]:pl[4]===l.substr(S,pl[5])?B=pl[4]:pl[6]===l.substr(S,pl[7])&&(B=pl[6]),E===B)S+=R,b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b="";else if(T===B){if(S+=L,d=b,b="",-1<(g=d.indexOf(H))?(tl=d.slice(g+1),d=d.slice(0,g)):tl=null,v=u?il>S?l[y](S):"":d[y](0),Y===v||z===v)al=1,z===v?(r=1,f=-1):(r=0,f=0),u?(S+=1,il>S&&F===l[y](S)?(ul=1,S+=1):ul=0):F===d[y](1)?(ul=1,d=d.slice(2)):(ul=0,d=d.slice(1));else if(Q===v){if(u){for(b="",k=S+1,G=il;G>k&&W!==l[y](k);)b+=l[y](k++);S=k+1}else{for(b="",k=1,G=d.length;G>k&&W!==d[y](k);)b+=d[y](k++);d=d.slice(k+1)}b=b.split(","),b.length>1?(r=w(b[0]),r=r.length?0|+r:0,f=w(b[1]),f=f.length?0|+f:-1,al=1):(r=w(b[0]),r=r.length?0|+r:0,f=r,al=0),b="",ul=0}else al=0,ul=0,r=0,f=0;if(ul&&null===tl&&(tl=""),v=d[y](0),nl===v?(ol=1,d=d.slice(1)):ol=0,v=d[y](0),Z===v?(rl=1,d=d.slice(1)):rl=0,p=-1<d.indexOf(ll)?d.split(ll):[d,null],d=p[0],p=p[1],o=-1<d.indexOf(Z)?d.split(Z):null,O&&!n(x,O)&&(x[O]={}),K+M===l.substr(S,2+N)&&(S+=2,p=p&&p.length?p:"grtpl--"+t(),D=p,O&&d.length&&(x[O][d]=p)),!d.length)continue;null==p&&O&&n(x,O)&&n(x[O],d)&&(p=x[O][d]),al&&!$.opt?($.name=d,$.key=o,$.stpl=p,$.dval=tl,$.opt=al,$.neg=ul,$.algn=ol,$.loc=rl,$.start=r,$.end=f,j=new i(null,[d,o,ul,r,f,al,rl])):al?(r!==f&&$.start===$.end&&($.name=d,$.key=o,$.stpl=p,$.dval=tl,$.opt=al,$.neg=ul,$.algn=ol,$.loc=rl,$.start=r,$.end=f),j=new i(j,[d,o,ul,r,f,al,rl])):al||null!==$.name||($.name=d,$.key=o,$.stpl=p,$.dval=tl,$.opt=0,$.neg=ul,$.algn=ol,$.loc=rl,$.start=r,$.end=f,j=new i(null,[d,o,ul,r,f,0,rl])),0===m.node.type&&(m.node.algn=a(m.node.val,0,m.node.val.length)),m=new s({type:1,name:d,key:o,stpl:p,dval:tl,opt:al,algn:ol,loc:rl,start:r,end:f},m)}else if(M===B){if(S+=N,b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b="",J===l[y](S)){for(k=S+1,G=il;G>k&&el!==l.substr(k,V+1);)b+=l[y](k++);S=k+V+1,0===m.node.type&&(m.node.algn=a(m.node.val,0,m.node.val.length)),m=new s({type:-100,val:b},m),b="";continue}c=new i(c,[m,C,$,j,O,D]),D&&(O=D),D=null,$={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},j=null,m=new s({type:0,val:"",algn:""}),C=m}else P===B?(S+=V,h=m,I=C,U=$,q=j,c?(m=c.value[0],C=c.value[1],$=c.value[2],j=c.value[3],O=c.value[4],D=c.value[5],c=c.prev):m=null,b.length&&(0===h.node.type?h.node.val+=b:h=new s({type:0,val:b,algn:""},h)),b="",D?(_[D]=new s({type:2,name:U.name,key:U.key,loc:U.loc,algn:U.algn,start:U.start,end:U.end,opt_args:null,tpl:I}),D=null):(0===m.node.type&&(m.node.algn=a(m.node.val,0,m.node.val.length)),m=new s({type:-1,name:U.name,key:U.key,loc:U.loc,algn:U.algn,start:U.start,end:U.end,opt_args:q,tpl:I},m))):(v=l[y](S++),"\n"===v?(b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),b="",0===m.node.type&&(m.node.algn=a(m.node.val,0,m.node.val.length)),m=new s({type:100,val:"\n"},m)):b+=v);else b+=il>S+1?l[y](S+1):"",S+=2;return b.length&&(0===m.node.type?m.node.val+=b:m=new s({type:0,val:b,algn:""},m)),0===m.node.type&&(m.node.algn=a(m.node.val,0,m.node.val.length)),[A,_]}function p(l,n,e,t,a,o,i){var s,f,p,d,c,v,y,m,h=null,b="";if(-1===n.type){if(s=n.opt_args,s&&s.value[5])for(;s;){if(f=s.value,p=r(l,f[1],[String(f[0])],f[6]?null:i),null===h&&n.name===f[0]&&(h=p),0===f[2]&&null==p||1===f[2]&&null!=p)return"";s=s.prev}}else h=r(l,n.key,[String(n.name)],n.loc?null:i);if(d=u(h),m=d?h.length:-1,d&&m>n.start)for(c=n.start,v=-1===n.end?m-1:Math.min(n.end,m-1),y=c;v>=y;y++)b+=g(l,n.tpl,e,t,y,o,i);else d||n.start!==n.end||(b=g(l,n.tpl,e,t,null,o,i));return b}function d(l,e,t,a,i,s,f){var d,g,v,y,m="";if(e.stpl&&(n(t,e.stpl)||n(c.subGlobal,e.stpl)||n(a,e.stpl)||n(a,"*")||n(c.fnGlobal,e.stpl)||n(c.fnGlobal,"*")))if(d=r(l,e.key,[String(e.name)],e.loc?null:f),n(t,e.stpl)||n(c.subGlobal,e.stpl))null==i||0===i&&e.start===e.end&&e.opt||!u(d)||(d=i<d.length?d[i]:null),null==d&&null!==e.dval?m=e.dval:(v=n(t,e.stpl)?t[e.stpl].node:c.subGlobal[e.stpl].node,g={},null!=d&&(u(d)?g[v.name]=d:g=d),m=p(g,v,t,a,null,e.algn?s:"",null==f?l:f));else{if(y=null,n(a,e.stpl)?y=a[e.stpl]:n(a,"*")?y=a["*"]:n(c.fnGlobal,e.stpl)?y=c.fnGlobal[e.stpl]:c.fnGlobal["*"]&&(y=c.fnGlobal["*"]),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),"function"==typeof y){var h={symbol:e,index:i,currentArguments:l,originalArguments:f,alignment:s};d=y(d,h)}else d=String(y);m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=o(m,s))}else e.opt&&null!==e.dval?m=e.dval:(d=r(l,e.key,[String(e.name)],e.loc?null:f),u(d)&&(i=null!=i?i:e.start,d=i<d.length?d[i]:null),m=null==d&&null!==e.dval?e.dval:String(d),e.algn&&(m=o(m,s)));return m}function g(l,n,e,t,u,a,o){a=a||"";for(var r,i=a,s="";n;)r=n.node.type,-1===r?s+=p(l,n.node,e,t,u,n.node.algn?i:a,o):1===r?s+=d(l,n.node,e,t,u,n.node.algn?i:a,o):0===r?(i+=n.node.algn,s+=n.node.val):100===r&&(i=a,s+="\n"+a),n=n.next;return s}function c(l,n,e){var t=this;return t instanceof c?(t.id=null,t.tpl=null,t.fn={},void(t._args=[l||"",n||c.defaultDelimiters,e||!1])):new c(l,n,e)}var v="prototype",y="charAt",m=Object[v].hasOwnProperty,h=Object[v].toString,b=/^\s+|\s+$/g,w=String[v].trim?function(l){return l.trim()}:function(l){return l.replace(b,"")};return t.GUID=0,c.VERSION="3.0.0",c.defaultDelimiters=["<",">","[","]"],c.fnGlobal={},c.subGlobal={},c.guid=t,c.multisplit=f,c.align=o,c.main=g,c[v]={constructor:c,id:null,tpl:null,fn:null,_args:null,dispose:function(){var l=this;return l.id=null,l.tpl=null,l.fn=null,l._args=null,l},parse:function(){var l=this;return null===l.tpl&&null!==l._args&&(l.tpl=c.multisplit(l._args[0],l._args[1],l._args[2]),l._args=null),l},render:function(l){var n=this;return null===n.tpl&&n.parse(),c.main(null==l?{}:l,n.tpl[0],n.tpl[1],n.fn)}},c});