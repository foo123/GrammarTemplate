/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 2.1.1
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(l,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(l.$deps=l.$deps||{})&&(l.EXPORTED_SYMBOLS=[n])&&(l[n]=l.$deps[n]=e.call(l)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(l)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,e.call(l))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(l)}):n in l||(l[n]=e.call(l)||1)&&"function"==typeof define&&define.amd&&define(function(){return l[n]})}(this,"GrammarTemplate",function(l){"use strict";function n(){return""+(new Date).getTime()+"--"+ ++m}function e(l){return l instanceof Array||"[object Array]"===d.call(l)}function t(l,n,e,t){var u,r,i,s,o=0;if(n)for(u=l,r=n.length,i=0,o=1;r>i;){if(s=n[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=l,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&null!=t&&t!==l){if(n)for(u=t,r=n.length,i=0,o=1;r>i;){if(s=n[i++],null==u||null==u[s]){o=0;break}u=u[s]}if(!o&&e)for(u=t,r=e.length,i=0,o=1;r>i;){if(s=e[i++],null==u||null==u[s]){o=0;break}u=u[s]}}return o?u:null}function u(l,n){this.prev=l||null,this.value=n||null}function r(l,n){n&&(n.next=this),this.node=l||null,this.prev=n||null,this.next=null}function i(l,e,t){var i,s,o,a,p,f,d,g,m,v,h,b,k,S,w,_,x,O,$,j,C,D,G,q,A,E,T,B=e[0],I=e[1],M=e[2],R=e[3],L=e[4],N=B.length,P=I.length,U=M.length,V=R.length,X=L.length,Y="\\",z="?",F="*",H="!",J="|",K="{",Q="}",W=".",Z=":",ll=null,nl=0,el=0,tl=l.length;for(t=!0===t,m=new r({type:0,val:""}),C={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},G=m,q=null,D=null,x={},$=null,O={},j=null,d=null,h="",w=!1,b=0;tl>b;)if(w=!1,_=l[c](b),Y===_&&(w=!0,b+=1),B===l.substr(b,N)){if(b+=N,w){h+=B;continue}h.length&&(0===m.node.type?m.node.val+=h:m=new r({type:0,val:h},m)),h=""}else if(I===l.substr(b,P)){if(b+=P,w){h+=I;continue}if(p=h,h="",-1<(f=p.indexOf(J))?(ll=p.slice(f+1),p=p.slice(0,f)):ll=null,g=t?tl>b?l[c](b):"":p[c](0),z===g||F===g)el=1,F===g?(s=1,o=-1):(s=0,o=0),t?(b+=1,tl>b&&H===l[c](b)?(nl=1,b+=1):nl=0):H===p[c](1)?(nl=1,p=p.slice(2)):(nl=0,p=p.slice(1));else if(K===g){if(t){for(h="",k=b+1,S=tl;S>k&&Q!==l[c](k);)h+=l[c](k++);b=k+1}else{for(h="",k=1,S=p.length;S>k&&Q!==p[c](k);)h+=p[c](k++);p=p.slice(k+1)}h=h.split(","),h.length>1?(s=y(h[0]),s=s.length?0|+s:0,o=y(h[1]),o=o.length?0|+o:-1,el=1):(s=y(h[0]),s=s.length?0|+s:0,o=s,el=0),h="",nl=0}else el=0,nl=0,s=0,o=0;if(nl&&null===ll&&(ll=""),a=-1<p.indexOf(Z)?p.split(Z):[p,null],p=a[0],a=a[1],i=-1<p.indexOf(W)?p.split(W):null,$&&!O[$]&&(O[$]={}),L+M===l.substr(b,X+U)&&(b+=X,a=a&&a.length?a:"grtpl--"+n(),j=a,$&&p.length&&(O[$][p]=a)),!p.length)continue;null==a&&$&&O[$]&&O[$][p]&&(a=O[$][p]),el&&!C.opt?(C.name=p,C.key=i,C.stpl=a,C.dval=ll,C.opt=el,C.neg=nl,C.start=s,C.end=o,D=new u(null,[p,i,nl,s,o,el])):el?D=new u(D,[p,i,nl,s,o,el]):el||null!==C.name||(C.name=p,C.key=i,C.stpl=a,C.dval=ll,C.opt=0,C.neg=nl,C.start=s,C.end=o,D=new u(null,[p,i,nl,s,o,0])),m=new r({type:1,name:p,key:i,stpl:a,dval:ll,opt:el,start:s,end:o},m)}else if(M===l.substr(b,U)){if(b+=U,w){h+=M;continue}h.length&&(0===m.node.type?m.node.val+=h:m=new r({type:0,val:h},m)),h="",d=new u(d,[m,q,C,D,$,j]),j&&($=j),j=null,C={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},D=null,m=new r({type:0,val:""}),q=m}else if(R===l.substr(b,V)){if(b+=V,w){h+=R;continue}v=m,A=q,E=C,T=D,d?(m=d.value[0],q=d.value[1],C=d.value[2],D=d.value[3],$=d.value[4],j=d.value[5],d=d.prev):m=null,h.length&&(0===v.node.type?v.node.val+=h:v=new r({type:0,val:h},v)),h="",j?(x[j]=new r({type:2,name:E.name,key:E.key,start:0,end:0,opt_args:null,tpl:A}),j=null):m=new r({type:-1,name:E.name,key:E.key,start:E.start,end:E.end,opt_args:T,tpl:A},m)}else h+=l[c](b++);return h.length&&(0===m.node.type?m.node.val+=h:m=new r({type:0,val:h},m)),[G,x]}function s(l,n,u,r,i,s){var o,p,f,d,c,g,y,m,v=null,h="";if(-1===n.type){if(o=n.opt_args,o&&o.value[5])for(;o;){if(p=o.value,f=t(l,p[1],[String(p[0])],s),null===v&&n.name===p[0]&&(v=f),0===p[2]&&null==f||1===p[2]&&null!=f)return"";o=o.prev}}else v=t(l,n.key,[String(n.name)],s);if(d=e(v),m=d?v.length:-1,d&&m>n.start)for(c=n.start,g=-1===n.end?m-1:Math.min(n.end,m-1),y=c;g>=y;y++)h+=a(l,n.tpl,u,r,y,s);else d||n.start!==n.end||(h=a(l,n.tpl,u,r,null,s));return h}function o(l,n,u,r,i,o){var a,f,d,c,g="";return n.stpl&&(u&&u[n.stpl]||r&&r[n.stpl]||p.fnGlobal[n.stpl])?(a=t(l,n.key,[String(n.name)],o),u&&u[n.stpl]?(null==i||0===i&&n.opt||!e(a)||(a=a[i]),null==a&&null!==n.dval?g=n.dval:(d=u[n.stpl].node,f={},null!=a&&(e(a)?f[d.name]=a:f=a),g=s(f,d,u,r,null,null==o?l:o))):(c=r&&r[n.stpl]?r[n.stpl]:p.fnGlobal[n.stpl]?p.fnGlobal[n.stpl]:null,e(a)&&(i=null!=i?i:n.start,a=i<a.length?a[i]:null),a="function"==typeof c?c(a,i,l,o,n):String(c),g=null==a&&null!==n.dval?n.dval:String(a))):n.opt&&null!==n.dval?g=n.dval:(a=t(l,n.key,[String(n.name)],o),e(a)&&(i=null!=i?i:n.start,a=i<a.length?a[i]:null),g=null==a&&null!==n.dval?n.dval:String(a)),g}function a(l,n,e,t,u,r){for(var i,a="";n;)i=n.node.type,a+=-1===i?s(l,n.node,e,t,u,r):1===i?o(l,n.node,e,t,u,r):n.node.val,n=n.next;return a}function p(l,n,e){var t=this;return t instanceof p?(t.id=null,t.tpl=null,t.fn={},void(t._args=[l||"",n||p.defaultDelims,e||!1])):new p(l,n,e)}var f="prototype",d=Object[f].toString,c="charAt",g=/^\s+|\s+$/g,y=String[f].trim?function(l){return l.trim()}:function(l){return l.replace(g,"")},m=0;return p.VERSION="2.1.1",p.defaultDelims=["<",">","[","]",":="],p.fnGlobal={},p.guid=n,p.multisplit=i,p.main=a,p[f]={constructor:p,id:null,tpl:null,fn:null,_args:null,dispose:function(){var l=this;return l.id=null,l.tpl=null,l.fn=null,l._args=null,l},parse:function(){var l=this;return null===l.tpl&&null!==l._args&&(l.tpl=p.multisplit(l._args[0],l._args[1],l._args[2]),l._args=null),l},render:function(l){var n=this;return null===n.tpl&&n.parse(),p.main(null==l?{}:l,n.tpl[0],n.tpl[1],n.fn)}},p});