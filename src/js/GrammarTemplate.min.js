/**
*   GrammarTemplate, 
*   versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 1.1.0
*   https://github.com/foo123/GrammarTemplate
*
**/
!function(e,n,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=t.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=t.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(l){l(n,t.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.moduleUri=n.uri,t.call(e)}):n in e||(e[n]=t.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"GrammarTemplate",function(e){"use strict";function n(e){return e instanceof Array||"[object Array]"===u.call(e)}function t(e,n){for(var t,l=e,i=n.length,u=0;i>u;){if(t=n[u++],!l||null==l[t])return null;l=l[t]}return l}function l(e,n){var t=this;return t instanceof l?(t.id=null,t.tpl=null,t._args=[e||"",n||l.defaultDelims],void(t._parsed=!1)):new l(e,n)}var i="prototype",u=Object[i].toString,r="charAt",s=/^\s+|\s+$/g,o=String[i].trim?function(e){return e.trim()}:function(e){return e.replace(s,"")};return l.VERSION="1.1.0",l.defaultDelims=["<",">","[","]"],l.multisplit=function(e,n){var t,l,i,u,s,f,p,c,a,d,h,g,m,y,_,b=n[0],v=n[1],S=n[2],$=n[3],O=b.length,j=v.length,C=S.length,I=$.length,x="\\",A="?",D="*",q="!",E="|",w="{",B="}",M=null,R=0,T=0,k=e.length;for(h=0,c=[[],null,null,0,0,0,0,null],f=[],d="",y=!1;k>h;)if(_=e[r](h),x===_&&(y=!y,h+=1),b===e.substr(h,O)){if(y){d+=b,h+=O,y=!1;continue}h+=O,d.length&&c[0].push([0,d]),d=""}else if(v===e.substr(h,j)){if(y){d+=v,h+=j,y=!1;continue}if(h+=j,u=d,d="",-1<(s=u.indexOf(E))?(M=u.slice(s+1),u=u.slice(0,s)):M=null,p=u[r](0),A===p||D===p)T=1,D===p?(l=1,i=-1):(l=0,i=0),u=u.slice(1),q===u[r](0)?(R=1,u=u.slice(1)):R=0;else if(w===p){for(d="",g=1,m=u.length;m>g&&B!==u[r](g);)d+=u[r](g++);u=u.slice(g+1),d=d.split(","),d.length>1?(l=o(d[0]),l=l.length?parseInt(l,10)||0:0,i=o(d[1]),i=i.length?parseInt(i,10)||0:-1,T=1):(l=o(d[0]),l=l.length?parseInt(l,10)||0:0,i=l,T=0),d="",R=0}else T=0,R=0,l=0,i=0;R&&null===M&&(M=""),t=-1<u.indexOf(".")?u.split("."):null,T&&!c[3]?(c[1]=u,c[2]=t,c[3]=T,c[4]=R,c[5]=l,c[6]=i,c[7]=[[u,R,l,i,t]]):T?c[7].push([u,R,l,i,t]):T||null!==c[1]||(c[1]=u,c[2]=t,c[3]=0,c[4]=R,c[5]=l,c[6]=i,c[7]=[[u,R,l,i,t]]),c[0].push([1,u,t,M,T,R,l,i])}else if(S===e.substr(h,C)){if(y){d+=S,h+=C,y=!1;continue}h+=C,d.length&&c[0].push([0,d]),d="",f.push(c),c=[[],null,null,0,0,0,0,null]}else if($===e.substr(h,I)){if(y){d+=$,h+=I,y=!1;continue}h+=I,a=c,c=f.pop(),d.length&&a[0].push([0,d]),d="",c[0].push([-1,a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[0]])}else d+=x===_?_:e[r](h++);return d.length&&c[0].push([0,d]),c[0]},l[i]={constructor:l,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},parse:function(){var e=this;return!1===e._parsed&&(e._parsed=!0,e.tpl=l.multisplit(e._args[0],e._args[1]),e._args=null),e},render:function(e){var l=this;!1===l._parsed&&l.parse(),e=e||{};var i,u,r,s,o,f,p,c,a,d,h,g,m,y,_=l.tpl,b=_.length,v=Math.min,S=null,$=0,O="",j=new Array(200),C=0;for(r=0;b>r||C;)if(r>=b)i=j[--C],_=i[0],r=i[1],b=i[2],S=i[3]||null,$=i[4]||0;else{if(s=_[r],o=s[0],f=s[1],-1===o){if(a=s[7],a&&a.length){for(d=!0,h=0,g=a.length;g>h;h++)if(m=a[h],y=m[4]?t(e,m[4]):e[m[0]],0===m[1]&&null==y||1===m[1]&&null!=y){d=!1;break}if(d){if(1===s[4]){j[C++]=[_,r+1,b,S,$],_=s[8],r=0,b=_.length,S=null,$=0;continue}if(y=s[2]?t(e,s[2]):e[f],u=n(y),u&&s[5]!==s[6]&&y.length>s[5]){if(p=s[5],c=-1===s[6]?y.length-1:v(s[6],y.length-1),c>=p){for(j[C++]=[_,r+1,b,S,$],_=s[8],r=0,b=_.length,S=f,$=c;$>p;$--)j[C++]=[_,0,b,S,$];$=p;continue}}else if(!u&&s[5]===s[6]){j[C++]=[_,r+1,b,S,$],_=s[8],r=0,b=_.length,S=f,$=0;continue}}}}else 1===o?(y=s[2]?t(e,s[2]):e[f],O+=null==y&&null!==s[3]?s[3]:n(y)?f===S?y[s[6]===s[7]?s[6]:$]:y[s[6]]:y):O+=f;r++}return O}},l});